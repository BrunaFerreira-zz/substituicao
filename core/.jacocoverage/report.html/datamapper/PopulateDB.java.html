<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PopulateDB.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;core&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.html" class="el_package">datamapper</a> &gt; <span class="el_source">PopulateDB.java</span></div><h1>PopulateDB.java</h1><pre class="source lang-java linenums">/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package datamapper;
import auxiliar.Perfil;
import datamapper.exceptions.NonexistentEntityException;
import dominio.Aula;
import dominio.Ausencia;
import dominio.Professor;
import dominio.Usuario;
import java.sql.*;
import java.util.Calendar;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import org.joda.time.DateTime;
import org.joda.time.DateTimeConstants;
import org.joda.time.Interval;

/**
 *
 * @author Leticia
 */
<span class="nc" id="L24">public class PopulateDB {</span>
    
    public static void main (String[]args) throws NonexistentEntityException, Exception{
<span class="nc" id="L27">        PopulateDB.fullSetupDB(&quot;prosub&quot;, &quot;root&quot;, &quot;&quot;);</span>
        //PopulateDB.recreateDB(&quot;prosub&quot;, &quot;root&quot;, &quot;&quot;);
<span class="nc" id="L29">    }</span>
    
    public static void fullSetupDB(String dbName, String user, String password) throws NonexistentEntityException, Exception{
                
<span class="fc" id="L33">        dropDB(dbName, user, password);</span>
<span class="fc" id="L34">        createDB(dbName, user, password);</span>
<span class="fc" id="L35">        populateDB();</span>
<span class="fc" id="L36">    }</span>
    
    public static void recreateDB(String dbName, String user, String password){
<span class="fc" id="L39">        dropDB(dbName, user, password);</span>
<span class="fc" id="L40">        createDB(dbName, user, password);</span>
<span class="fc" id="L41">    }</span>
    
    private static void dropDB(String dbName, String username, String password){
        
<span class="fc" id="L45">    Connection conn = null;</span>
<span class="fc" id="L46">    Statement stmt = null;</span>
<span class="fc" id="L47">    String dbURL = &quot;jdbc:mysql://localhost&quot;;</span>

   try{
      //STEP 2: Register JDBC driver
<span class="fc" id="L51">      Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span>

      //STEP 3: Open a connection
<span class="fc" id="L54">      System.out.println(&quot;Connecting to a selected database...&quot;);</span>
<span class="fc" id="L55">      conn = DriverManager.getConnection(dbURL, username, password);</span>
<span class="fc" id="L56">      System.out.println(&quot;Connected database successfully...&quot;);</span>
      
      //STEP 4: Execute a query
<span class="fc" id="L59">      System.out.println(&quot;Deleting database &quot; + dbName + &quot;...&quot;);</span>
<span class="fc" id="L60">      stmt = conn.createStatement();</span>
      
<span class="fc" id="L62">      String sql = &quot;DROP DATABASE &quot; + dbName;</span>
<span class="fc" id="L63">      stmt.executeUpdate(sql);</span>
<span class="fc" id="L64">      System.out.println(&quot;Database deleted successfully...&quot;);</span>
<span class="nc" id="L65">   }catch(SQLException se){</span>
      //Handle errors for JDBC
<span class="nc" id="L67">      se.printStackTrace();</span>
<span class="nc" id="L68">   }catch(Exception e){</span>
      //Handle errors for Class.forName
<span class="nc" id="L70">      e.printStackTrace();</span>
   }finally{
      //finally block used to close resources
<span class="nc" id="L73">      try{</span>
<span class="pc bpc" id="L74" title="7 of 8 branches missed.">         if(stmt!=null)</span>
<span class="pc" id="L75">            conn.close();</span>
<span class="nc" id="L76">      }catch(SQLException se){</span>
<span class="pc" id="L77">      }// do nothing</span>
      try{
<span class="pc bpc" id="L79" title="7 of 8 branches missed.">         if(conn!=null)</span>
<span class="pc" id="L80">            conn.close();</span>
<span class="nc" id="L81">      }catch(SQLException se){</span>
<span class="nc" id="L82">         se.printStackTrace();</span>
<span class="pc" id="L83">      }//end finally try</span>
<span class="nc" id="L84">   }//end try</span>
<span class="fc" id="L85">   System.out.println(&quot;Finished!&quot;);</span>
<span class="fc" id="L86">   System.out.println(&quot;========================================================================&quot;);</span>
        
<span class="fc" id="L88">    }</span>
    
    private static void createDB(String dbName, String username, String password){
<span class="fc" id="L91">    Connection conn = null;</span>
<span class="fc" id="L92">    Statement stmt = null;</span>
<span class="fc" id="L93">    String dbURL = &quot;jdbc:mysql://localhost&quot;;</span>

   try{
      //STEP 2: Register JDBC driver
<span class="fc" id="L97">      Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span>

      //STEP 3: Open a connection
<span class="fc" id="L100">      System.out.println(&quot;Connecting to a selected database...&quot;);</span>
<span class="fc" id="L101">      conn = DriverManager.getConnection(dbURL, username, password);</span>
<span class="fc" id="L102">      System.out.println(&quot;Connected database successfully...&quot;);</span>
      
      //STEP 4: Execute a query
<span class="fc" id="L105">      System.out.println(&quot;Creating database &quot; + dbName +  &quot;...&quot;);</span>
<span class="fc" id="L106">      stmt = conn.createStatement();</span>
      
<span class="fc" id="L108">      String sql = &quot;CREATE DATABASE &quot; + dbName;</span>
<span class="fc" id="L109">      stmt.executeUpdate(sql);</span>
<span class="fc" id="L110">      System.out.println(&quot;Database deleted successfully...&quot;);</span>
<span class="nc" id="L111">   }catch(SQLException se){</span>
      //Handle errors for JDBC
<span class="nc" id="L113">      se.printStackTrace();</span>
<span class="nc" id="L114">   }catch(Exception e){</span>
      //Handle errors for Class.forName
<span class="nc" id="L116">      e.printStackTrace();</span>
   }finally{
      //finally block used to close resources
<span class="nc" id="L119">      try{</span>
<span class="pc bpc" id="L120" title="7 of 8 branches missed.">         if(stmt!=null)</span>
<span class="pc" id="L121">            conn.close();</span>
<span class="nc" id="L122">      }catch(SQLException se){</span>
<span class="pc" id="L123">      }// do nothing</span>
      try{
<span class="pc bpc" id="L125" title="7 of 8 branches missed.">         if(conn!=null)</span>
<span class="pc" id="L126">            conn.close();</span>
<span class="nc" id="L127">      }catch(SQLException se){</span>
<span class="nc" id="L128">         se.printStackTrace();</span>
<span class="pc" id="L129">      }//end finally try</span>
<span class="nc" id="L130">   }//end try</span>
<span class="fc" id="L131">   System.out.println(&quot;Finished!&quot;);</span>
<span class="fc" id="L132">   System.out.println(&quot;========================================================================&quot;);</span>
        
<span class="fc" id="L134">    }</span>
    
    private static void populateDB() throws NonexistentEntityException, Exception{
        
<span class="fc" id="L138">        EntityManagerFactory emf = Persistence.createEntityManagerFactory(&quot;pro_subPU&quot;);</span>
        
<span class="fc" id="L140">        populateUsuario(emf);</span>
<span class="fc" id="L141">        populateProfessores(emf);</span>
        
<span class="fc" id="L143">        populateAusencia(emf);</span>
        
<span class="fc" id="L145">    }</span>
    
    private static void populateProfessores(EntityManagerFactory emf){
        
<span class="fc" id="L149">        AulaJpaController aulaJpa = new AulaJpaController(emf);</span>
        
<span class="fc" id="L151">        DateTime comeco1 = new DateTime(2013, 06, 10, 10, 10);</span>
<span class="fc" id="L152">        DateTime fim1 = new DateTime(2013, 06, 10, 10, 20);</span>
        
<span class="fc" id="L154">        Interval periodo = new Interval(comeco1, fim1);</span>
        
<span class="fc" id="L156">        Aula aula = new Aula(DateTimeConstants.MONDAY, periodo);</span>
<span class="fc" id="L157">        aulaJpa.create(aula);</span>
        
<span class="fc" id="L159">        DateTime comeco2 = new DateTime(2013, 06, 10, 18, 20);</span>
<span class="fc" id="L160">        DateTime fim2 = new DateTime(2013, 06, 10, 20, 0);</span>
        
<span class="fc" id="L162">        Interval periodo2 = new Interval(comeco2, fim2);</span>

        
        //Periodo periodo2 = new Periodo(comeco2, fim2);
        
<span class="fc" id="L167">        Aula aula2 = new Aula(DateTimeConstants.MONDAY, periodo2);</span>
<span class="fc" id="L168">        aulaJpa.create(aula2);</span>
        
<span class="fc" id="L170">        Professor prof1 = new Professor(&quot;Calebe&quot;, &quot;calebe&quot;);</span>
        
<span class="fc" id="L172">        prof1.adicionarAula(aula);</span>
        
<span class="fc" id="L174">        Professor prof2 = new Professor(&quot;Ana Claudia&quot;, &quot;anarossi&quot;);</span>
<span class="fc" id="L175">        prof2.adicionarAula(aula2);</span>
        
<span class="fc" id="L177">        Professor prof3 = new Professor(&quot;Vilar&quot;, &quot;vilar&quot;);</span>
        
<span class="fc" id="L179">        DateTime comeco3 = new DateTime(2013, 06, 10, 9, 0);</span>
<span class="fc" id="L180">        DateTime fim3 = new DateTime(2013, 06, 10, 11, 0);</span>
        
<span class="fc" id="L182">        Interval periodo3 = new Interval(comeco3, fim3);</span>
        
<span class="fc" id="L184">        Aula aula3 = new Aula(DateTimeConstants.MONDAY, periodo3);</span>
<span class="fc" id="L185">        aulaJpa.create(aula3);</span>
        
<span class="fc" id="L187">        prof3.adicionarAula(aula3);</span>
        
        //prof1.adicionarAula(aula);
        
<span class="fc" id="L191">        Professor prof4 = new Professor(&quot;Gaston&quot;, &quot;gaston&quot;);</span>
        
        
        //prof2.adicionarAula(aula2);
        
<span class="fc" id="L196">        Professor prof5 = new Professor(&quot;Denise&quot;, &quot;denise&quot;);</span>
        //prof1.adicionarAula(aula);

<span class="fc" id="L199">        DateTime comeco4 = new DateTime(2013, 06, 10, 8, 0);</span>
<span class="fc" id="L200">        DateTime fim4 = new DateTime(2013, 06, 10, 10, 20);</span>
        
<span class="fc" id="L202">        Interval periodo4 = new Interval(comeco4, fim4);</span>
        
<span class="fc" id="L204">        Aula aula4 = new Aula(DateTimeConstants.MONDAY, periodo4);</span>
<span class="fc" id="L205">        aulaJpa.create(aula4);</span>
        
<span class="fc" id="L207">        prof5.adicionarAula(aula4);</span>
        
        
<span class="fc" id="L210">        ProfessorJpaController profJpa = new ProfessorJpaController(emf);</span>
        
<span class="fc" id="L212">        profJpa.create(prof1);</span>
<span class="fc" id="L213">        profJpa.create(prof2);</span>
<span class="fc" id="L214">        profJpa.create(prof3);</span>
<span class="fc" id="L215">        profJpa.create(prof4);</span>
<span class="fc" id="L216">        profJpa.create(prof5);</span>
<span class="fc" id="L217">    }</span>
    
    private static void populateUsuario(EntityManagerFactory emf){
        
<span class="fc" id="L221">        UsuarioJpaController usuarioJpa = new UsuarioJpaController(emf);</span>
        
<span class="fc" id="L223">        Usuario u1 = Usuario.createUsuarioPadrao(&quot;calebe&quot;);</span>
<span class="fc" id="L224">        u1.setPermissao(Perfil.PROFESSOR);</span>
        
        
<span class="fc" id="L227">        Usuario u2 = Usuario.createUsuarioPadrao(&quot;jane&quot;);</span>
<span class="fc" id="L228">        u2.setPermissao(Perfil.FUNCIONARIO);</span>
<span class="fc" id="L229">        u2.setSenha(&quot;mackenzie&quot;);</span>
        
<span class="fc" id="L231">        Usuario u3 = Usuario.createUsuarioPadrao(&quot;admin&quot;);</span>
<span class="fc" id="L232">        u3.setSenha(&quot;admin&quot;);</span>
<span class="fc" id="L233">        u3.setPermissao(Perfil.ADMINISTRADOR);</span>
        
<span class="fc" id="L235">        Usuario u4 = Usuario.createUsuarioPadrao(&quot;anarossi&quot;);</span>
<span class="fc" id="L236">        u4.setPermissao(Perfil.PROFESSOR);</span>
        
<span class="fc" id="L238">        Usuario u5 = Usuario.createUsuarioPadrao(&quot;vilar&quot;);</span>
<span class="fc" id="L239">        u5.setPermissao(Perfil.PROFESSOR);</span>
        
<span class="fc" id="L241">        Usuario u6 = Usuario.createUsuarioPadrao(&quot;gaston&quot;);</span>
<span class="fc" id="L242">        u6.setPermissao(Perfil.PROFESSOR);</span>
        
        
<span class="fc" id="L245">        Usuario u7 = Usuario.createUsuarioPadrao(&quot;denise&quot;);</span>
<span class="fc" id="L246">        u7.setPermissao(Perfil.PROFESSOR);</span>
        
        
<span class="fc" id="L249">        usuarioJpa.create(u1);</span>
<span class="fc" id="L250">        usuarioJpa.create(u2);</span>
<span class="fc" id="L251">        usuarioJpa.create(u3);</span>
<span class="fc" id="L252">        usuarioJpa.create(u4);</span>
<span class="fc" id="L253">        usuarioJpa.create(u5);</span>
<span class="fc" id="L254">        usuarioJpa.create(u6);</span>
<span class="fc" id="L255">        usuarioJpa.create(u7);</span>
        
<span class="fc" id="L257">    }</span>
    
    public static void populateUsuario(){
<span class="fc" id="L260">        EntityManagerFactory emf = Persistence.createEntityManagerFactory(&quot;pro_subPU&quot;);</span>
<span class="fc" id="L261">        PopulateDB.populateUsuario(emf);</span>
<span class="fc" id="L262">    }</span>
    
    public static void populateProfessores(){
<span class="fc" id="L265">        EntityManagerFactory emf = Persistence.createEntityManagerFactory(&quot;pro_subPU&quot;);</span>
<span class="fc" id="L266">        PopulateDB.populateProfessores(emf);        </span>
<span class="fc" id="L267">    }</span>

    private static void populateAusencia(EntityManagerFactory emf) throws NonexistentEntityException, Exception {
        
<span class="fc" id="L271">        AusenciaJpaController ausenciaJpa = new AusenciaJpaController(emf);</span>
<span class="fc" id="L272">        ProfessorJpaController professorJpa = new ProfessorJpaController(emf);</span>
        
<span class="fc" id="L274">        DateTime d1 = new DateTime(2013, 05, 02, 0, 0);</span>
<span class="fc" id="L275">        DateTime d2 = new DateTime(2013, 05, 02, 0, 0);</span>
        
<span class="fc" id="L277">        Interval periodo = new Interval(d1, d2);</span>
        
<span class="fc" id="L279">        Professor professorAusente = professorJpa.findProfessor(&quot;Gaston&quot;);</span>
        
<span class="fc" id="L281">        Ausencia ausencia = new Ausencia(&quot;1234&quot;, periodo, professorAusente, &quot;Um motivo&quot;);</span>
        
<span class="fc" id="L283">        Professor professorSubstituto = professorJpa.findProfessor(&quot;Denise&quot;);</span>
<span class="fc" id="L284">        ausencia.indicarSubstituto(professorSubstituto);</span>
        
<span class="fc" id="L286">        ausenciaJpa.create(ausencia);</span>
        
        
        
//        
//        Ausencia ausencia2 = ausenciaJpa.findAusencia(&quot;1234&quot;);
//        
//        
//        
//        ausencia2.indicarSubstituto(professorSubstituto);
//        
//        ausenciaJpa.edit(ausencia2);
        
<span class="fc" id="L299">    }</span>
    
}


</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span></div></body></html>